/*!
 * ParamQuery Select v2.1.0
 * 
 * Copyright (c) 2015-2023 Paramvir Dhindsa (http://paramquery.com)
 * Released under Commercial license
 * http://paramquery.com/pro/license
 *
 */
if("function"==typeof require){var jQuery=require("jquery"),pq={};module.exports=pq}else var pq=window.pq||{};!function(a){"use strict";a.support.touch="ontouchend"in document;var b={};b.options=function(){var b=a.ui.keyCode;return{radio:!1,singlePlaceholder:"Select an option",checkbox:!1,displayText:"{0} of {1} selected",maxDisplay:4,maxHeight:300,maxSelect:0,multiplePlaceholder:"Select options",selectallText:"Select All",closeOnWindowScroll:!0,closeOnWindowResize:!0,itemCls:"pq-select-item ui-corner-all ui-state-default",bootstrap:{on:!1,btn:"btn btn-default",popupCont:"panel panel-default",selectCls:"label label-info",itemCls:"label label-default",closeIcon:"glyphicon glyphicon-remove",searchIcon:"glyphicon glyphicon-search",hoverCls:""},position:{my:"left top",at:"left bottom",collision:"flipfit"},kcOpen:[b.DOWN,b.ENTER,b.UP],deselect:!0,hoverCls:"pq-state-hover",optionsResizable:{handles:"e,s"},search:!0,searchRule:"contain",_selectCls:"pq-state-select",selectCls:"ui-state-highlight",width:null,rowHt:25,maxSelectReach:null,maxSelectExceed:null,valIndx:"val",textIndx:"text"}}(),b.destroy=function(){this._super();for(var a in this)delete this[a]},b._setOption=function(a,b){this._super(a,b),"disabled"==a?(b&&this.close(),this.$button[b?"addClass":"removeClass"]("ui-state-disabled")):"maxHeight"==a?(this.$popup.css({maxHeight:b,height:""}),this.setMenuHt(),this.renderView()):"data"==a&&(this.data=this.options.data,this.refresh())},a.widget("paramquery.pqSelect",b),pq.select=function(b,c){var d=a(b).pqSelect(c),e=d.data("ui.pqSelect");return e},b=a.paramquery.pqSelect.prototype,b._setButtonWidth=function(){if(this.isSelect){var a=this.element;a.show();var b=this.options,c=b.width?b.width:a[0].offsetWidth,c=1*c==c?c+"px":c;a.hide(),this.$button[0].style.width=c}},b.val=function(){var a=this.options,b=a.valIndx,c=a.textIndx,d=this.data.filter(function(a){return a.selected}).map(function(a){var d=a[b];return null==d?a[c]:d});return this.multiple?d:d[0]},b._create=function(){var b,c=this,d=c.options,e=c.element,f=c.isSelect=e.is("select"),g=d.bootstrap,h=g.on,i=e.attr("name"),j=e.attr("multiple"),k=c.eventNamespace;h&&(d.selectCls+=" "+g.selectCls,d.itemCls+=" "+g.itemCls),f?(b=a(["<div class='pq-select-button pq-no-capture pq-border-2 ",h?g.btn:"ui-state-default ui-widget ui-corner-all","' "," data-name='",i,"' tabindex='0'>","</div>"].join("")),e.after(b),b.attr("name",i),b.addClass(e.attr("class")),e.addClass("pq-select")):(c.divClass=e.attr("class")||"",b=e,b.addClass("pq-select-button pq-no-capture pq-border-2 ui-state-default ui-widget ui-corner-all")),b.html("<span class='pq-icon "+(h?"caret":"ui-icon ui-icon-triangle-1-s")+"'></span><div class='pq-select-text'></div>"),c.$button=b,c.multiple=j?!0:!1,c.selector=".pq-select-option.ui-state-enable:visible",c._setButtonWidth(),d.data?c.data=d.data:c._extractData(),c._createPopup(),c._createMenu(),b.on({click:function(){if(!d.disabled){var b=a(this).parent(".pq-select-item"),e=parseInt(b.attr("data-id"));return c.select(e,!1),c.setText(),c.setSelectAllState(),c.focus(),c.triggerChange(),!1}}},".pq-item-close"),b.on({click:function(){return d.disabled?void 0:(c.toggle(),!1)},focus:function(){d.disabled||a(this).addClass("ui-state-hover")},blur:function(){a(this).removeClass("ui-state-hover")},mousedown:function(){d.disabled||a(this).addClass("ui-state-active")},mouseup:function(){d.disabled||a(this).removeClass("ui-state-active")},keydown:function(b){if(!d.disabled){var e=b.keyCode,f=d.kcOpen,g=a.ui.keyCode;-1!==a.inArray(e,f)?c.open():e===g.ESCAPE?c.close():e===g.SPACE&&c.toggle()}}}),c.setText(),c.setSelectAllState(),a(window).on("resize"+k,c.onWindowResize.bind(c)).on("scroll"+k,c.onWindowScroll.bind(c))},b.onWindowResize=function(a){var b=a.originalEvent;b&&"mousemove"==b.type||!this.options.closeOnWindowResize||this.close()},b.onWindowScroll=function(){this.options.closeOnWindowScroll&&!this._preventClose&&this.close()},b.focus=function(){var b=this,c=b.$search;a.support.touch||(c[0]?c.focus():b.$popup.focus(),b._highlight())},b.getOption=function(b){return a("#"+this.getOptionId(b))},b.getOptionId=function(a){return"pq-option-"+this.uuid+"-"+a},b._move=function(a,b,c){var d,e,f=this,g=f.optionIndxV,h=null==g?-1:g,i=f.options,j=f.$menu,k=j[0],l=k.offsetHeight,m=f.dataV,n=m.length,o=i.rowHt,p=function(a){return!m[a].disabled&&!m[a].pq_title},q=Math.floor((l-17)/o);if(c)d=a?n-1:0;else if(b)d=a?h+q:h-q;else if(a){for(e=h+1;n>e;e++)if(p(e)){d=e;break}}else for(e=h-1;e>=0;e--)if(p(e)){d=e;break}0>d&&(d=0),d>=n&&(d=n-1),f.focusOption(d)},b.focusOption=function(a){var b,c=this,d=c.options,e=d.rowHt,f=a*e,g=f+e,h=c.$menu,i=h[0],j=i.scrollTop,k=i.offsetHeight,l=j+k,m=function(){c._highlight(a)};j>f?b=f:g>l&&(b=g-k),null!=b?(h.one("scroll",function(){m()}),i.scrollTop=b):m()},b._onkeydown=function(b){var c,d=b.keyCode,e=this,f=e.optionIndxV,g=a.ui.keyCode;return d===g.DOWN||d===g.UP?(e._move(d===g.DOWN),c=!1):d===g.PAGE_DOWN||d===g.PAGE_UP?(e._move(d==g.PAGE_DOWN,!0),c=!1):d==g.HOME||d==g.END?(e._move(d==g.END,!1,!0),c=!1):d===g.TAB?(e.close(),c=!1):d===g.ESCAPE?e.close():d===g.ENTER&&null!=f&&(e.getOption(f).trigger("label_changed"),c=!1),c},b.search=function(a){for(var b=this.data,c=this.options,d=c.searchRule,e=c.textIndx,f="contain"===d,g=0,h=b.length;h>g;g++){var i=b[g],j=(i[e]+"").toUpperCase(),k=j.indexOf(a);i.searchIndx=null,-1===k?i.hidden=!0:f===!1&&k>0?i.hidden=!0:(i.hidden=!1,i.searchIndx=k)}},b._onkeyupsearch=function(b){var c=a(b.target),d=this,e=a.trim(c.val()).toUpperCase();(e||d.searchText)&&e!=d.searchText&&(d.searchText=e,d.search(e),d._createMenu(),d.renderView(),d.positionPopup(),d.setSelectAllState())},b.onChange=function(a){var b=this,c=b.dataV[a],d=c.pq_indx,e=!c.selected,f=b.options,g=b.multiple,h=f.maxSelect,i=b.selectIndx;if(g){if(e&&h&&i.length>=h)return b._trigger("maxSelectExceed",null,{option:b.$options[d]}),b.focus(),!1}else if(i.length){var j=i[0];if(d===j)return!1;e&&b.select(j,!1)}b.select(d,e),b.setText(),b.setSelectAllState(),g?h&&i.length>=h?b._trigger("maxSelectReach",null,{option:b.$options[d]})!==!1&&b.close():b.focus():b.close(),b.triggerChange()},b.setSelectAllState=function(){var a=this.$popup.find(".pq-select-all input"),b=a[0];if(b){for(var c,d,e=this.dataV,f=0,g=0,h=0,i=e.length;i>h;h++)d=e[h],d.disabled||d.pq_title||(f++,d.selected&&g++);c=f===g,a.prop("checked",c),b.indeterminate=c?!1:g>0}},b.getInstance=function(){return{select:this}},b.select=function(b,c){var d,e=this,f=e.selectIndx,g=e.data,h=e.options,i=g[b],j=e.$options,k=j?a(j[b]):a(),l=e.getOption(i.pq_indxV),m=l.find("input");l[c?"addClass":"removeClass"](h._selectCls+" "+h.selectCls),m.prop("checked",c),i.selected=c,e.multiple?(d=f.indexOf(b),c?-1==d&&f.push(b):d>-1&&f.splice(d,1),k.prop("selected",c)):c?(f.length&&f[0]!=b&&(g[f[0]].selected=!1),f[0]=b,k.prop("selected",c)):(e.selectIndx=[0],g[0].selected=!0,(j?a(j[0]):a()).prop("selected",!0))},b.triggerChange=function(){this._trigger("change"),this.element.trigger("change")},b._extractData=function(){var b,c,d=this.data=[],e=this.element,f=e.find("option,optgroup"),g=!1,h=!1;this.$options=e.find("option");for(var i=0,j=f.length;j>i;i++){var k=f[i],l=a(k);if("optgroup"==k.nodeName.toLowerCase())c=l.attr("label"),g=!0,h=l.prop("disabled");else{var m=l.prop("selected"),n=l.prop("disabled");!n&&g&&(n=h),b=l.text(),d.push({selected:m,disabled:n,text:b,val:l.val(),optgroup:c})}}this.grouping=g},b.exportData=function(){return JSON.stringify(this.data,null,2)},b.refresh=function(){this.search(""),this._setButtonWidth(),this._createPopup(),this._createMenu(),this.setText(),this.setSelectAllState()},b.refreshData=function(){this._extractData(),this.refresh()},b._createPopup=function(){var b=this,c=this.options,d=c.bootstrap,e=d.on,f=b.multiple,g=b.$button.css("font-size"),h="",i="";f&&c.selectallText&&!c.maxSelect&&(i=["<label class='pq-select-all ui-widget-header ui-corner-all'>","<span class='ui-icon ui-icon-close ",e?d.closeIcon:"","'></span>","<input type='checkbox' >",c.selectallText,"</label>"].join("")),c.search&&(h=["<div class='pq-select-search-div ui-corner-all'>","<span class='ui-icon ui-icon-search ",e?d.searchIcon:"","'></span>","<div class='pq-select-search-div1'>","<input type='text' class='pq-select-search-input' autocomplete='off' style='height:",c.rowHt-2,"px;'/>","</div>","</div>"].join(""));var j=a(["<div class='pq-select-popup-cont ",e?d.popupCont:"","'>","<div class='pq-select-popup ui-widget-content ui-corner-all' tabindex='-1'>",i,h,"<div class='pq-select-menu'><div style='margin:0;padding:0;' ></div></div>","</div><div class='pq-select-shadow-fix'></div></div>"].join("")),k=j.children(".pq-select-popup");b.$menu=k.find(".pq-select-menu").on("scroll",b.onScroll.bind(b)).on("mousemove",b.onMouseMove.bind(b)),j.css({"font-family":this.$button.css("font-family"),"font-size":0==parseInt(g)?"inherit":g}),k.css("maxHeight",c.maxHeight).on({keydown:function(a){return b._onkeydown(a)}}).on({mouseenter:function(){b._highlight(b.getIndxV(this.id))},label_changed:function(){var a=this.id;return a?b.onChange(b.getIndxV(a)):void 0}},".pq-select-option.ui-state-enable"),k.find(".ui-icon-close").on({click:function(){return b.close(),!1}}),f&&c.checkbox||!f&&c.radio?k.on({click:function(){a(this).closest("label").trigger("label_changed")}},"label.pq-select-option.ui-state-enable input"):k.on({click:function(){a(this).trigger("label_changed")}},"label.pq-select-option.ui-state-enable"),b.$popupCont&&b.$popupCont.remove(),b.$popupCont=j,k.resizable(a.extend(!0,{stop:b.onResized.bind(b)},c.optionsResizable)),b.$popup=k,b.$search=k.find(".pq-select-search-input").on({keyup:function(a){return b._onkeyupsearch(a)}}),b.$selectAll=k.find(".pq-select-all").on({change:b.onSelectAll.bind(b)},"input"),a(document.body).append(j)},b.onSelectAll=function(b){for(var c,d=a(b.target),e=this,f=d.prop("checked")?!0:!1,g=e.dataV,h=0,i=e.$options;h<g.length;h++)c=g[h],c.disabled||c.selected===f||(c.selected=f,i&&a(i[c.pq_indx]).prop("selected",f));e._createMenu(),e.renderView(),e.setText(),e.focus(),e.triggerChange()},b.onResized=function(a,b){this.width=b.size.width,this.option("maxHeight",b.size.height)},b.getIndxV=function(a){return 1*a.split("-")[3]},b.getIndx=function(a){return this.dataV[this.getIndxV(a)].pq_indx},b._createMenu=function(){var a,b,c=this,d=c.data,e=c.options,f=e.rowHt,g=e.textIndx,h=c.selectIndx=[],i=c.dataV=[],j=0,k=c.$menu.children();d.forEach(function(c,d){c.pq_indx=d,a=c.optgroup,(0!=d||""!=c[g])&&(c.selected&&h.push(d),b===a||c.hidden||(i[j++]={pq_title:!0,text:a},b=a),c.hidden||(c.pq_indxV=j,i[j++]=c))}),c._initV=c._finalV=null,k.html(""),k.height(i.length*f),c.setMenuHt()},b.onMouseMove=function(){this.preventClose()},b.preventClose=function(){var a=this;a._preventClose=!0,clearTimeout(a.mmtimerID),a.mmtimerID=setTimeout(function(){a._preventClose=!1},2e3)},b.getViewPortIndx=function(){var a=this.$menu[0],b=this.options.rowHt,c=a.scrollTop,d=Math.floor(c/b),e=Math.floor((c+a.offsetHeight)/b);return[d,e]},b.renderView=function(){var a,b,c,d,e,f,g=this,h=g.uuid,i=g.getViewPortIndx(),j=i[0],k=i[1],l=g._initV,m=g._finalV,n=null!=l,o=g.options,p=o.textIndx,q=o.search?(g.searchText||"").length:0,r=" "+o._selectCls+" "+o.selectCls+" ",s=g.multiple,t=s?o.checkbox?'type="checkbox"':"":o.radio?'type="radio"':"",u=[],v=t?"pq-left-input":g.grouping?"pq-left-group":"",w=o.rowHt,x=function(a,b){return"style='position:absolute;top:"+a*w+"px;width:100%;left:0;height:"+w+"px;overflow:hidden;"+(b||"")+"'"},y=g.dataV;if(n)for(d=l;m>=d;d++)(j>d||d>k)&&g.getOption(d).remove();for(d=j;k>=d;d++)if(e=y[d]){var a=e.disabled,z=e.selected,A=e[p];if(n&&d>=l&&m>=d)continue;if(e.pq_title)u.push("<label ",x(d,e.style)," class='pq-select-optgroup'"," id='",g.getOptionId(d),"'>","<span>",A,"</span>","</label>");else{var B=z?' checked="checked" ':"",C=z?r:"",D=a?' disabled="disabled" ':"",b=a?"ui-state-disabled":"ui-state-enable";q&&(c=e.searchIndx,A=A.substr(0,c)+"<span class='pq-select-search-highlight'>"+A.substr(c,q)+"</span>"+A.substr(c+q,A.length)),u.push("<label ",x(d,e.style)," class='pq-select-option ",C,b,"'"," id='",g.getOptionId(d),"'>",t?"<input name='pq-select-input-"+h+"' "+t+" "+B+D+" >":"","<span class='",v,"'>",A,"</span>","</label>")}}g._initV=j,g._finalV=k,f=g.$menu.children(),f.append(u.join(""))},b.onScroll=function(){this.renderView(),this.preventClose()},b._highlight=function(a){var b=this,c=b.options.hoverCls,d=b._initV,e=b._finalV,f=function(a){return null!=a&&a>=d&&e>=a},g=b.optionIndxV,a=f(a)?a:f(g)?g:null,h=null!=a?b.getOption(a):b.$menu.find(".pq-select-option.ui-state-enable:visible:first"),i=h[0];i&&(a=b.getIndxV(i.id),null!=g&&b.getOption(g).removeClass(c),h.addClass(c),b.optionIndxV=a,b._trigger("focused",{label:i,rowIndx:a}))},b._setPopupWidth=function(){this.$popupCont.width(this.width||this.$button[0].offsetWidth)},b.positionPopup=function(){var b=this.options,c=this.$button,d=a.extend({of:c},b.position),e=this.$popupCont;this._setPopupWidth(),e.position(d)},b.isOpen=function(){return this.$popupCont&&"block"==this.$popupCont.css("display")?!0:!1},b.setMenuHt=function(){var a=this,b=a.options,c=b.rowHt,d=(a.$popup.find(".pq-select-search-div").outerHeight(!0)||0)+(a.$selectAll.outerHeight(!0)||0),e=a.dataV.length,f=e*c,g=Math.min(f+d,b.maxHeight),h=g-d;a.$menu.css("height",h+"px")},b.open=function(){var b=this,c=b.$popupCont;return b.isOpen()?!1:(c.show(),b.positionPopup(),b.setMenuHt(),b.renderView(),a(document).on("mousedown"+b.eventNamespace,function(c){var d=a(c.target);d.closest(b.$popupCont)[0]||d.closest(b.$button)[0]||b.close()}),void b.focus())},b.setText=function(){var a,b=this,c=b.$button,d=c.find(".pq-select-text"),e=b.element,f=b.options,g=f.textIndx,h=f.deselect,i=b.data,j=f.itemCls,k=f.bootstrap,l=k.on?k.closeIcon:"ui-icon ui-icon-close",m=function(a){return h?["<span class='",j,"' data-id = '",a,"'>","<span class='pq-item-close ",l,"'></span>","<span class='pq-select-item-text'>",i[a][g],"</span>","</span>"].join(""):i[a][g]},n=b.selectIndx;if(b.multiple){c.addClass("pq-select-multiple");var o=n.length,p=f.maxDisplay,q=i.length;if(o>0)if(p>=o){for(var r=[],s=0;o>s;s++){var t=n[s];r.push(m(t))}a=r.join(h?"":", ")}else a=f.displayText,a=a.replace("{0}",n.length),a=a.replace("{1}",q);else a=e.attr("data-placeholder"),a||(a=f.multiplePlaceholder)}else{c.addClass("pq-select-single"),d.css("maxWidth",c.width()-16);var t=n[0],a=null!=t?i[t][g]:"";null!=a&&""!==a?a=m(t):(a=e.attr("data-placeholder"),a||(a=f.singlePlaceholder))}d.html(a),b.multiple||d.find(".pq-select-item-text").css({maxWidth:c.width()-35}),setTimeout(function(){b.uuid&&b.positionPopup()})},b.close=function(b){this.isOpen()&&(b=b||{},b.focus!==!1&&this.$button.focus(),this.$popupCont.hide()),a(document).off(this.eventNamespace)},b.toggle=function(){this.isOpen()?this.close():this.open()},b.disable=function(){this.option({disabled:!0})},b.enable=function(){this.option({disabled:!1})},b._destroy=function(){var b=this.$button,c=this.eventNamespace;this.$popupCont.remove(),this.isSelect?(b.remove(),this.element.removeClass("pq-select").show()):(b.empty(),b.off(),b.attr("class",this.divClass)),a(document).off(c),a(window).off(c)}}(jQuery);